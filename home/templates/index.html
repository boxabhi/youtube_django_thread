<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-eOJMYsd53ii+scO/bJGFsiCZc+5NDVN2yr8+0RDqr0Ql0h+rP48ckxlpbzKgwra6" crossorigin="anonymous">
</head>

<body>


    <div class="container mt-5 pt-5">
        <p id="percentage"></p>
        <div class="progress">
            <div class="progress-bar progress-bar-striped bg-success" role="progressbar" style="width: 10%" aria-valuenow="10" aria-valuemin="0" aria-valuemax="100"></div>
          </div>
        <table class="table">
            <thead>
                <tr>
                    <th scope="col">#</th>
                    <th scope="col">First</th>
                    <th scope="col">Last</th>
                    <th scope="col">Handle</th>
                </tr>
            </thead>
            <tbody id="render_table">
              
               
            </tbody>
        </table>
    </div>



    <script type="text/javascript">
        let socket = new WebSocket('ws://localhost:8000/ws/progress/');
        socket.onopen = function (e) {
            console.log('Connection established');
        };
        socket.onmessage = function (e) {
            var data = JSON.parse(e.data)
            var value = data.payload.progress
            increaseProgress(data.payload.count , data.payload.current)
            renderTable(data.payload.data)

        };

        function renderTable(data) {
            var table = document.getElementById("render_table");
            
            var html = `  <tr>
                    <th scope="row">${data.student_name}</th>
                    <td>${data.student_email}</td>
                    <td>${data.address}</td>
                
                </tr>
            `
            table.innerHTML += html
        }

        function increaseProgress( total , current ) {
            var progress = document.querySelector('.progress-bar')
            var percentage = current * (total/100)
            console.log(percentage)
            progress.style.width = percentage + "%"
            document.getElementById('percentage').innerHTML = `${current} % completed` 
        }
    </script>
</body>

</html>